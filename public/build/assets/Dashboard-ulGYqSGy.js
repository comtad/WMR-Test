import{_ as U}from"./AuthenticatedLayout-BfeYpZN3.js";import{y as m,g as p,o as d,b as e,i as $,D as I,e as z,t as f,E as N,G as P,H,n as B,A as D,I as W,q as A,J as E,a,d as o,h as L,w as n,f as v,F as S,z as q,c as G}from"./app-DFs_qqWh.js";import{_ as J,P as O,A as k,S as K,F as Q,T as b,m as R}from"./flowbite-vue-9Ai0uFnT.js";import"./ApplicationLogo-D97gtjzO.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const X={key:0,class:"mt-3 p-3 bg-gray-50 rounded-lg flex items-center"},Y={class:"text-sm text-gray-700 truncate"},Z={class:"mt-4"},ee={class:"mt-6"},te={class:"flex items-center justify-between"},se={class:"flex items-center"},le={class:"relative inline-flex items-center cursor-pointer"},ae={class:"ml-3 text-sm font-medium text-gray-700"},oe=["disabled"],ne={__name:"FileUploader",emits:["uploaded"],setup(T,{emit:y}){const g=y,l=m(null),i=m(""),h=m(!1),c=m(!1),C=m(!1),x=m(null),M=()=>{if(l.value){const u=l.value.name.split(".").pop(),s=i.value.endsWith(`.${u}`)?i.value:`${i.value}.${u}`;l.value=new File([l.value],s,{type:l.value.type,lastModified:l.value.lastModified})}},_=u=>{C.value=!1;const s=u.dataTransfer.files[0];s&&s.name.endsWith(".csv")&&(l.value=s,i.value=s.name.replace(/\.[^/.]+$/,""))},j=u=>{const s=u.target.files[0];s&&s.name.endsWith(".csv")&&(l.value=s,i.value=s.name.replace(/\.[^/.]+$/,""))},F=()=>{x.value.click()},w=()=>{l.value=null,i.value="",x.value&&(x.value.value="")},t=async()=>{await D.get("/sanctum/csrf-cookie",{withCredentials:!0})},r=async()=>{if(!l.value)return;c.value=!0,await t();const u=new FormData;u.append("file",l.value),u.append("is_private",h.value?"1":"0");try{const s=await D.post("/upload",u,{headers:{"Content-Type":"multipart/form-data"},withCredentials:!0});l.value=null,i.value="",h.value=!1,x.value&&(x.value.value=""),g("uploaded",s.data)}catch(s){s.response?.data?.message||s.message,console.error("Ошибка загрузки:",s)}finally{c.value=!1}};return(u,s)=>(d(),p("div",null,[e("div",{class:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center cursor-pointer transition-colors hover:border-blue-500 min-h-[130px] flex items-center justify-center",onDragover:s[0]||(s[0]=z(V=>C.value=!0,["prevent"])),onDragleave:s[1]||(s[1]=V=>C.value=!1),onDrop:z(_,["prevent"]),onClick:F},[e("input",{ref_key:"fileInput",ref:x,type:"file",class:"hidden",accept:".csv",onChange:j},null,544),s[4]||(s[4]=I('<div class="flex flex-col items-center justify-center"><svg class="w-8 h-8 text-gray-400 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg><p class="font-medium text-gray-700">Загрузить файл</p><p class="text-sm text-gray-500 mt-1">Нажмите или перетащите CSV файл сюда</p></div>',1))],32),l.value?(d(),p("div",X,[s[6]||(s[6]=e("svg",{class:"w-5 h-5 text-green-500 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),e("span",Y,f(l.value.name),1),e("button",{class:"ml-auto text-gray-500 hover:text-red-500",onClick:w},s[5]||(s[5]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))])):$("",!0),e("div",Z,[s[7]||(s[7]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Имя файла",-1)),N(e("input",{"onUpdate:modelValue":s[2]||(s[2]=V=>i.value=V),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Введите имя для файла",onInput:M},null,544),[[P,i.value]])]),e("div",ee,[e("div",te,[e("div",se,[e("label",le,[N(e("input",{"onUpdate:modelValue":s[3]||(s[3]=V=>h.value=V),type:"checkbox",class:"sr-only peer"},null,512),[[H,h.value]]),s[8]||(s[8]=e("div",{class:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"},null,-1)),e("span",ae," Тип: "+f(h.value?"Приватный":"Публичный"),1)])]),e("button",{disabled:c.value||!l.value,class:B(["px-4 py-2 rounded-md font-medium transition-colors",c.value||!l.value?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-green-600 text-white hover:bg-green-700"]),onClick:r},f(c.value?"Загрузка...":"Загрузить"),11,oe)])])]))}},re={class:"py-12"},ie={class:"mx-auto max-w-7xl sm:px-6 lg:px-8 px-10"},de={class:"bg-white rounded-lg shadow p-6 mb-8"},ue={class:"bg-white rounded-lg shadow p-6"},pe={class:"flex justify-between items-center mb-4"},ce={key:0,class:"flex items-center"},ve={class:"text-sm text-gray-600"},fe={class:"flex items-center"},me={class:"truncate max-w-xs"},ge={key:0},xe={key:1,class:"text-gray-500"},we=["href"],he={key:1,class:"text-gray-400"},ye={key:0,class:"text-center py-8"},_e={key:1,class:"mt-6 flex justify-end"},$e={__name:"Dashboard",setup(T){const y=m([]),g=m(1),l=m(1),i=m(!1),{props:h}=W();h.auth.user.id;const c=async(w=1)=>{i.value=!0;try{const t=await D.get("/media/accessible",{params:{page:w}});y.value=[...t.data.data],g.value=t.data.meta.current_page,l.value=t.data.meta.last_page}catch(t){console.error("Ошибка загрузки медиа:",t),y.value=[]}finally{i.value=!1}},C=w=>{c(w)},x=()=>{c(g.value)},M=w=>{w.action==="update_table"&&c(g.value)};let _=null;const j=()=>{_=window.Echo.channel("media.events"),_.listen(".media.media",M)},F=()=>{_&&_.stopListening(".media.media",M)};return A(()=>{c(),j()}),E(()=>{F()}),(w,t)=>(d(),p(S,null,[a(o(L),{title:"Загрузчик файлов"}),a(U,null,{header:n(()=>t[1]||(t[1]=[e("h2",{class:"text-xl font-semibold leading-tight text-gray-800"}," Загрузчик файлов ",-1)])),default:n(()=>[e("div",re,[e("div",ie,[e("div",de,[t[2]||(t[2]=e("h3",{class:"text-lg font-semibold mb-4"},"Загрузка CSV файлов",-1)),a(ne,{onUploaded:x})]),e("div",ue,[e("div",pe,[t[3]||(t[3]=e("h3",{class:"text-lg font-semibold"},"История загрузок",-1)),l.value>1?(d(),p("div",ce,[e("span",ve," Страница "+f(g.value)+" из "+f(l.value),1)])):$("",!0)]),a(o(J),{striped:""},{default:n(()=>[a(o(O),null,{default:n(()=>[a(o(k),null,{default:n(()=>t[4]||(t[4]=[v("Дата",-1)])),_:1,__:[4]}),a(o(k),null,{default:n(()=>t[5]||(t[5]=[v("Имя файла",-1)])),_:1,__:[5]}),a(o(k),null,{default:n(()=>t[6]||(t[6]=[v("Записей",-1)])),_:1,__:[6]}),a(o(k),null,{default:n(()=>t[7]||(t[7]=[v("Статус",-1)])),_:1,__:[7]}),a(o(k),null,{default:n(()=>t[8]||(t[8]=[v("Автор",-1)])),_:1,__:[8]}),a(o(k),{class:"text-right"},{default:n(()=>t[9]||(t[9]=[v("Действия",-1)])),_:1,__:[9]})]),_:1}),a(o(K),null,{default:n(()=>[(d(!0),p(S,null,q(y.value,r=>(d(),G(o(Q),{key:r.id,class:B({"opacity-50":i.value,"transition-opacity duration-300":!0})},{default:n(()=>[a(o(b),null,{default:n(()=>[v(f(r.date),1)]),_:2},1024),a(o(b),null,{default:n(()=>[e("div",fe,[t[10]||(t[10]=e("svg",{class:"w-4 h-4 text-gray-500 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),e("span",me,f(r.filename),1)])]),_:2},1024),a(o(b),null,{default:n(()=>[v(f(r.record_count),1)]),_:2},1024),a(o(b),null,{default:n(()=>[e("span",{class:B([r.status.color,"px-2.5 py-0.5 rounded-full text-xs font-medium border"])},f(r.status.value),3)]),_:2},1024),a(o(b),null,{default:n(()=>[r.author?(d(),p("span",ge,[t[11]||(t[11]=e("svg",{class:"w-4 h-4 text-gray-500 inline mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})],-1)),v(" "+f(r.author),1)])):(d(),p("span",xe,t[12]||(t[12]=[e("svg",{class:"w-4 h-4 text-gray-500 inline mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})],-1),v(" Приватный ",-1)])))]),_:2},1024),a(o(b),{class:"text-right"},{default:n(()=>[r.download_json&&r.download_json!=="Недоступно"?(d(),p("a",{key:0,href:r.download_json,target:"_blank",class:"inline-flex items-center text-blue-600 hover:text-blue-800 font-medium"},t[13]||(t[13]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1),e("span",{class:"ml-1"},"Скачать",-1)]),8,we)):(d(),p("span",he,"Недоступно"))]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:1})]),_:1}),y.value.length===0?(d(),p("div",ye,t[14]||(t[14]=[e("svg",{class:"w-16 h-16 text-gray-300 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),e("p",{class:"mt-4 text-gray-500"},"Нет загруженных файлов",-1)]))):$("",!0),l.value>1?(d(),p("div",_e,[a(o(R),{modelValue:g.value,"onUpdate:modelValue":[t[0]||(t[0]=r=>g.value=r),C],"slice-length":4,"total-pages":l.value,"hide-labels":"","show-icons":""},null,8,["modelValue","total-pages"])])):$("",!0)])])])]),_:1})],64))}};export{$e as default};
